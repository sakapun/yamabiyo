<!DOCTYPE html>
<html lang="jp">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>やまびよ新潟版</title>
    <meta desctiption='新潟の山の登山快適指数を見やすくするWebサービスです。'>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-xxs-1.0.1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker.standalone.min.css">
    <link rel="stylesheet" href="/css/my.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">
      var mtArr = [
        // {name:'弥彦山',pref:'15' ,code:'15150001',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150001&amp;type=15&amp;ba=hr" },
        // {name:'妙高高原',pref:'15' ,code:'15150002',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150002&amp;type=15&amp;ba=hr" },
        // {name:'越後湯沢',pref:'15' ,code:'15150003',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150003&amp;type=15&amp;ba=hr" },
        // {name:'苗場',pref:'15' ,code:'15150004',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150004&amp;type=15&amp;ba=hr" },
        {name:'妙高山',pref:'15' ,code:'15150005',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150005&amp;type=15&amp;ba=hr" },
        {name:'火打山',pref:'15' ,code:'15150006',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150006&amp;type=15&amp;ba=hr" },
        {name:'越後駒ヶ岳',pref:'15' ,code:'15150007',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150007&amp;type=15&amp;ba=hr" },
        {name:'平ヶ岳',pref:'15' ,code:'15150008',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150008&amp;type=15&amp;ba=hr" },
        {name:'巻機山',pref:'15' ,code:'15150009',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150009&amp;type=15&amp;ba=hr" },
        {name:'二王子岳',pref:'15' ,code:'15150010',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150010&amp;type=15&amp;ba=hr" },
        {name:'御神楽岳',pref:'15' ,code:'15150011',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150011&amp;type=15&amp;ba=hr" },
        {name:'八海山',pref:'15' ,code:'15150012',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150012&amp;type=15&amp;ba=hr" },
        {name:'えぶり差岳',pref:'15' ,code:'15150013',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150013&amp;type=15&amp;ba=hr" },
        {name:'苗場山',pref:'15' ,code:'15150015',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150015&amp;type=15&amp;ba=hr" },
        {name:'小蓮華山',pref:'15' ,code:'15150016',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150016&amp;type=15&amp;ba=hr" },
        {name:'守門岳',pref:'15' ,code:'15150017',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150017&amp;type=15&amp;ba=hr" },
        // {name:'坂戸山',pref:'15' ,code:'15150018',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150018&amp;type=15&amp;ba=hr" },
        {name:'金北山',pref:'15' ,code:'15150019',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150019&amp;type=15&amp;ba=hr" },
        // {name:'鳴倉山',pref:'15' ,code:'15150020',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150020&amp;type=15&amp;ba=hr" },
        {name:'仙ノ倉山',pref:'15' ,code:'15150021',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150021&amp;type=15&amp;ba=hr" },
        {name:'浅草岳',pref:'15' ,code:'15150022',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150022&amp;type=15&amp;ba=hr" },
        {name:'粟ヶ岳',pref:'15' ,code:'15150023',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150023&amp;type=15&amp;ba=hr" },
        // {name:'米山',pref:'15' ,code:'15150024',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150024&amp;type=15&amp;ba=hr" },
        {name:'大源太山',pref:'15' ,code:'15150025',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150025&amp;type=15&amp;ba=hr" },
        // {name:'五頭山',pref:'15' ,code:'15150026',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150026&amp;type=15&amp;ba=hr" },
        {name:'新潟焼山',pref:'15' ,code:'15150027',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150027&amp;type=15&amp;ba=hr" },
        {name:'大日岳',pref:'15' ,code:'15150028',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150028&amp;type=15&amp;ba=hr" },
        {name:'神楽ケ峰',pref:'15' ,code:'15150029',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150029&amp;type=15&amp;ba=hr" },
        {name:'粟立山',pref:'15' ,code:'15150030',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150030&amp;type=15&amp;ba=hr" },
        // {name:'ドンデン山',pref:'15' ,code:'15150031',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150031&amp;type=15&amp;ba=hr" },
        {name:'阿寺山',pref:'15' ,code:'15150032',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150032&amp;type=15&amp;ba=hr" },
        {name:'白山',pref:'15' ,code:'15150033',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150033&amp;type=15&amp;ba=hr" },
        // {name:'大蔵山',pref:'15' ,code:'15150034',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150034&amp;type=15&amp;ba=hr" },
        // {name:'菅名岳',pref:'15' ,code:'15150035',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150035&amp;type=15&amp;ba=hr" },
        // {name:'菱ヶ岳',pref:'15' ,code:'15150036',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150036&amp;type=15&amp;ba=hr" },
        {name:'高津倉山',pref:'15' ,code:'15150037',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150037&amp;type=15&amp;ba=hr" },
        {name:'鉾ヶ岳',pref:'15' ,code:'15150038',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150038&amp;type=15&amp;ba=hr" },
        // {name:'光兎山',pref:'15' ,code:'15150039',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150039&amp;type=15&amp;ba=hr" },
        {name:'北股岳',pref:'15' ,code:'15150040',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=15150040&amp;type=15&amp;ba=hr" },
        {name:'飯豊山',pref:'7' ,code:'07150003',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=07150003&amp;type=15&amp;ba=hr" },
        {name:'雨飾山',pref:'20' ,code:'20150040',  url: "http://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=20150040&amp;type=15&amp;ba=hr" }
      ];
    </script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
  <div class="jumbotron special">
    <div class="container">
      <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12 outline">
          <h1>山登り日和り</h1>
          <p>&nbsp;あの山に登りたいな、今週は・・・</p>
        </div>
        <div class="form-group col-md-4 col-sm-8 col-xs-12">
          <div class="input-group input-group-lg">
            <span class="input-group-addon triggerDate"><span class="glyphicon glyphicon-time" aria-hidden="true"></span></span>
            <input class="form-control" id="dp1" maxlength="10" type="text" name="date" data-provide="datepicker" placeholder='日付を選ぶ...'>
            <span class="input-group-btn">
              <button class="btn btn-default" id="dateSearchBot" type="submit">検索</button>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="main" class="site-main">
    <div class="background-section">
      <div class="container">
        <script type="text/javascript">
        (function(){
          mtArr.forEach(function(elem, index, array){
            document.write("<div class='col-md-2 col-sm-3 col-xs-4 col-xxs-6 "+ elem.code + "'><p class='text-center mt-name'>"+ elem.name +"<a href='" + elem.url +"' target='_blank'><span class='glyphicon glyphicon-share glyph-link'></span></a></p><div class='text-center div-round'><p><img alt='' class='weather' src='/img/base_mountain.png' data-holder-rendered='true'></p></div></div>");
          });
        })();
        </script>
      </div>
    </div>
  </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/locales/bootstrap-datepicker.ja.min.js"></script>
    <script type="text/javascript">
    var ajaxLock = false;

    var yamabiyo = {
      today: (function(){return new Date();})(),
      overnight: 21,
      overmorning: 9,
      pickIndex: function(intDayIndex, chkhour){
        return this.today.getHours() >= chkhour ? intDayIndex : intDayIndex -1;
      },
      startDate: function(){return new Date(this.today.getFullYear(), this.today.getMonth(), this.today.getDate() + this.pickIndex(1, this.overmorning))},
      endDate: function(){return new Date(this.today.getFullYear(), this.today.getMonth(), this.today.getDate() + this.pickIndex(7, this.overnight))},
      searchDay: null,
      searchDayIndex: null,
      eqIndex:null,
      getSearchDay: function(){
        this.searchDay = $("#dp1").datepicker('getDate');
        this.searchDayIndex = Math.ceil((this.searchDay.getTime() - this.today.getTime()) / (60 * 60 * 24 * 1000));
        this.eqIndex = this.calcIndex();
        return this.searchDay;
      },
      calcIndex: function(){
        var nightValue = this.today.getHours() >= this.overnight ? -1 : 0;
        switch(this.searchDayIndex){
          case 0:
          case 1:
            return this.searchDayIndex + nightValue;
            break;
          default:
            return this.searchDayIndex + 1 +nightValue;
        }
      },
      yamabiyoAjax: function(elem, index, array){
        self = this
        var apiPath = '/search/?mount=';
        setTimeout(function(){
          $.ajax({
            url:apiPath + elem.code
          }).done(function(data){
            var imgSrc = $(data).filter('td').eq(self.eqIndex).find('img').attr('src');
            $('.' + elem.code).find('img.weather').attr('src', imgSrc);
          }).fail(
          ).always(function(){
            if(array.length -1 === index) ajaxLock = false;
          });
        }, index * 300);
      }
    }

    $(function(){
      $('#dp1').datepicker({
          format: 'mm月dd日',
          startDate: yamabiyo.startDate(),
          endDate: yamabiyo.endDate(),
          language: 'ja',
          orientation: "top",
          autoclose: true,
          disableTouchKeyboard:true
      });

      $("#dateSearchBot").on('click', function(){
        if(ajaxLock === true) return false;
        ajaxLock = true;
        if(typeof yamabiyo.getSearchDay() === 'undefined') return false;
        $('.div-round img').attr('src', '/img/loading.gif');
        mtArr.forEach(yamabiyo.yamabiyoAjax,yamabiyo);
        var mainTop = $('#main').offset().top;
        $('body').animate({scrollTop: mainTop});
      });
      $('.triggerDate').on('click', function(){ $("#dp1").trigger('focus') })
    })
    </script>
    <div id="preload"></div>
  </body>
</html>